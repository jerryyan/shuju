<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>文件管理</title>
    <link rel="stylesheet" href="/static/assert/layui/css/layui.css">
    <link rel="stylesheet" href="/static/assert/bootstrap/css/bootstrap.css">
    <style>
        a {
            text-decoration: none !important;
        }
    </style>
</head>

<body>
    <div class="layui-layout layui-layout-admin">
        <div class="layui-header">
            <div class="layui-logo">文件管理</div>
        </div>
        {include file="common/left" /}

        <div class="layui-body" style="padding: 15px;">
            <!-- 内容主体区域 -->
            <div class="layui-row layui-col-space18">
                <!-- <div class="layui-col-md2">
                    <select class="form-control xiangmu">
                        <option selected>请选择项目</option>
                        <option value="远大肛肠">远大肛肠</option>
                        <option value="远大胃肠">远大胃肠</option>
                    </select>
                </div>
                <div class="layui-col-md2">
                    <select class="form-control qudao">
                        <option selected>请选择渠道</option>
                        <option value="百度">百度</option>
                        <option value="搜狗">搜狗</option>
                        <option value="神马">神马</option>
                        <option value="360">360</option>
                    </select>
                </div> -->
                <!-- <div class="layui-col-md10">
                    <div class="layui-upload">
                        <button type="button" class="layui-btn layui-btn-normal" id="test8">选择文件</button>
                        <button type="button" class="layui-btn" id="test9">提交</button>
                    </div>
                </div> -->
            </div>
            <table class="layui-table">
                <thead>
                    <tr>
                        <th>序号</th>
                        <td>项目</td>
                        <th>渠道</th>
                        <th>文件名</th>
                        <th>添加时间</th>
                        <th>编辑</th>
                    </tr>
                </thead>
                <tbody class="tb">
                    {volist name="data" id="vo"}
                    <tr>
                        <td>{$vo.id}</td>
                        <td>{$vo.xiangmu}</td>
                        <td>{$vo.source}</td>
                        <td>{$vo.name}</td>
                        <td>{$vo.atime}</td>
                        <td>
                            <button type="button" onclick="deleted({$vo.id})" class="layui-btn layui-btn-xs">删除</button>
                        </td>
                    </tr>
                    {/volist}
                </tbody>
            </table>
            <div id="fenye"></div>
            <div class="layui-input-inline">
                <input type="text" class="layui-input" id="time1" placeholder="yyyy-MM-dd">
            </div>
            <button type="button" class="btn btn-success abc">处理已上传商务通和竞价数据</button>
        </div>

        <div class="layui-footer">
            <!-- 底部固定区域 -->
            深圳远大肛肠医院
        </div>

    </div>
</body>
<script src="/static/assert/layui/layui.js"></script>
<script>
    layui.use(['table', 'element','laypage', 'form', 'upload', 'laydate'], function () {
        var element = layui.element
        var table = layui.table
        var $ = layui.jquery
        var upload = layui.upload;
        var laydate = layui.laydate;
        var laypage = layui.laypage;

        laydate.render({
            elem: '#time1',
            value: new Date()
        });
        //选完文件后不自动上传
        // upload.render({
        //     elem: '#test8',
        //     url: '/sousuo/swtImport',
        //     data: {
        //         xiangmu: function () {
        //             return $('.xiangmu').val()
        //         },
        //         qudao: function () {
        //             return $('.qudao').val()
        //         }
        //     },
        //     before: function (obj) { 
        //         layer.load(); 
        //     },
        //     auto: false,
        //     accept: 'file',
        //     bindAction: '#test9',
        //     done: function (res) {
        //         layer.closeAll();
        //         layer.msg(res.msg);
        //     }
        // });
        select(1)
        function select(pageIndex) {
            $.ajax({
                type: "post",
                url: "url",
                data: {
                    timer: $('#time1').val(),
                    pageIndex: pageIndex,
                    pageSize: 15,
                },
                dataType: "json",
                success: function (res) {
                    var html = template(tab, {
                        list: res
                    })
                    $('.tbd').html(html)
                    laypage.render({
                        elem: 'fenye',
                        count: 70,
                        jump: function (obj, first) {
                            if (!first) {
                                select(obj.curr)
                            }
                        }
                    });
                }
            });
        }

        $('.abc').click(function () {
            layer.open({
                type: 3,
            });
            $.ajax({
                type: "post",
                url: "/sousuo/swtData",
                data: {
                    timer: $('#time1').val()
                },
                dataType: "json",
                success: function (res) {
                    layer.closeAll();
                    layer.msg(res.msg);

                }
            });
        })
    })

    function deleted(ids) {
        var $ = layui.jquery;
        layer.open({
            type: 1,
            content: '<p style="text-align: center">确定删除吗?</p>',
            btn: ['确定', '取消'],
            yes: function (index, layero) {
                $.ajax({
                    type: "post",
                    dataType: "JSON",
                    url: "/sousuo/del",
                    data: {
                        id: ids
                    },
                    success: function (res) {
                        layer.closeAll();
                        layer.msg(`序号Id为${ids}的数据` + res.msg);
                        location.reload();
                    }
                });
            },
        });
    }
</script>

</html>